<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval" />
    <title>Optimus Prime Summary View</title>
    <style>
      html, body {
        margin: 0;
        padding: 0;
        height: 100%;
        background: transparent;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      }
      .panel {
        box-sizing: border-box;
        width: 100%;
        height: 100%;
        padding: 15px;
        background: rgba(10, 61, 98, 0.25);
        color: #fff;
        border-radius: 15px;
        border: 1px solid rgba(52, 152, 219, 0.3);
        display: flex;
        flex-direction: column;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }
      
      .header {
        display: flex;
        align-items: center;
        padding: 8px 0 15px;
        margin-bottom: 10px;
        border-bottom: 1px solid rgba(255,255,255, 0.1);
        background: rgba(255, 255, 255, 0.05);
        border-radius: 8px;
        padding-left: 5px;
        justify-content: space-between;
      }
      
      .header-title {
        font-size: 18px;
        font-weight: bold;
        color: #ecf0f1;
        flex: 1;
      }
      
      #close-btn {
        background: rgba(231, 76, 60, 0.3);
        color: white;
        border: none;
        border-radius: 50%;
        width: 30px;
        height: 30px;
        font-size: 18px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        margin-left: 10px;
      }
      
      #close-btn:hover {
        background: rgba(231, 76, 60, 0.5);
      }
      
      .content-container {
        flex: 1;
        overflow-y: auto;
        padding: 10px 0;
        line-height: 1.6;
      }
      
      /* Scrollbar styling */
      .content-container::-webkit-scrollbar {
        width: 6px;
      }
      .content-container::-webkit-scrollbar-track {
        background: rgba(0,0,0,0.1);
        border-radius: 10px;
      }
      .content-container::-webkit-scrollbar-thumb {
        background: #3498db;
        border-radius: 10px;
      }
      .content-container::-webkit-scrollbar-thumb:hover {
        background: #2980b9;
      }
    </style>
  </head>
  <body>
    <div class="panel" id="panel">
      <div class="header">
        <div class="header-title">Optimus Screen Summary</div>
        <button id="close-btn" title="Close Window">âœ•</button>
      </div>
      <div class="content-container" id="summaryContainer">
        <!-- Summary will be rendered here -->
      </div>
    </div>

    <script>
      const { ipcRenderer } = require('electron');
      
      // Get the close button and add event listener
      document.getElementById('close-btn').addEventListener('click', function() {
        window.close();
      });

      // Function to convert text with bullet points to HTML
      function convertBulletPointsToHTML(text) {
        // Split the text by newlines
        const lines = text.split('\n');
        
        // Process each line to identify bullet points and convert to HTML
        let htmlContent = '';
        for (let line of lines) {
          line = line.trim();
          if (line.startsWith('- ')) {
            // This is a bullet point
            htmlContent += `<li style="margin: 8px 0; padding-left: 10px;">${line.substring(2)}</li>`;
          } else if (line.length > 0) {
            // This is a regular paragraph
            htmlContent += `<p style="margin: 8px 0;">${line}</p>`;
          } else {
            // This is an empty line, add some space
            htmlContent += '<div style="height: 8px;"></div>';
          }
        }
        
        // Wrap consecutive bullet points in a list if there are any
        if (htmlContent.includes('<li')) {
          // Create a pattern to find sequences of bullet points and wrap them in <ul>
          const bulletSectionPattern = /(<li style="margin: 8px 0; padding-left: 10px;">.*?<\/li>[\s\n\r]*)+/g;
          htmlContent = htmlContent.replace(bulletSectionPattern, function(match) {
            // Wrap the matched bullet points in a <ul> tag
            return `<ul style="padding-left: 20px; margin: 10px 0;">${match}</ul>`;
          });
        }
        
        return htmlContent;
      }

      // Receive summary from main process
      ipcRenderer.on('set-summary', (event, summary) => {
        // Convert the summary to proper HTML with bullet points
        const htmlContent = convertBulletPointsToHTML(summary);
        document.getElementById('summaryContainer').innerHTML = htmlContent;
      });
      
      // Load summary when page loads if available
      document.addEventListener('DOMContentLoaded', function() {
        // If summary was passed as query parameter, use that
        const urlParams = new URLSearchParams(window.location.search);
        const summary = urlParams.get('summary');
        
        if (summary) {
          // Convert the summary to proper HTML with bullet points
          const htmlContent = convertBulletPointsToHTML(decodeURIComponent(summary));
          document.getElementById('summaryContainer').innerHTML = htmlContent;
        }
      });
    </script>
  </body>
</html>